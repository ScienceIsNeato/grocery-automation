<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuzzy Matching Tool</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
            background: #0d1117;
            color: #c9d1d9;
            font-size: 14px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        h1 { color: #58a6ff; margin: 0; font-size: 24px; }
        .source-badge {
            background: #8250df;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: default;
        }
        .phase-nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .phase-btn {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .phase-btn.active {
            background: #8250df;
            color: white;
        }
        .phase-btn.inactive {
            background: #21262d;
            color: #8b949e;
            border: 1px solid #30363d;
        }
        .phase-btn.inactive:hover {
            background: #30363d;
            color: #c9d1d9;
        }
        .phase-btn.loading {
            opacity: 0.6;
            cursor: wait;
        }
        .phase-btn.loading {
            opacity: 0.6;
            cursor: wait;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .stat { color: #8b949e; }
        .stat strong { color: #58a6ff; }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #161b22;
            border-radius: 6px;
            overflow: hidden;
            font-size: 13px;
        }
        th, td {
            padding: 12px 14px;
            text-align: left;
            border-bottom: 1px solid #21262d;
            vertical-align: top;
        }
        th {
            background: #21262d;
            color: #8b949e;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
        }
        tr:hover { background: #1c2128; }
        tr.mapped { background: #0d2818; }
        tr.new { background: #1e1a2d; }
        tr.processed { 
            opacity: 0; 
            transition: opacity 0.3s ease-out;
        }
        tr.processed.hidden { display: none; }
        .row-num { color: #8b949e; width: 50px; text-align: center; font-size: 13px; font-weight: 600; }
        .item-name { font-weight: 500; width: 280px; word-break: break-word; font-size: 14px; }
        .editable-item {
            padding: 4px 6px;
            border-radius: 3px;
            border: 1px solid transparent;
            display: inline-block;
            min-width: 100px;
        }
        .editable-item:hover { border-color: #30363d; background: #0d1117; }
        .editable-item:focus { 
            border-color: #58a6ff; 
            background: #0d1117; 
            outline: none; 
        }
        .editable-item.edited { 
            border-color: #d29922; 
            background: #2d1b0e;
        }
        .qty-cell { width: 90px; }
        .qty-input {
            width: 60px;
            padding: 8px 6px;
            border: 1px solid #30363d;
            border-radius: 4px;
            font-size: 12px;
            background: #0d1117;
            color: #c9d1d9;
            text-align: center;
        }
        .qty-input:focus { border-color: #58a6ff; outline: none; }
        .matches-cell { 
            display: flex; 
            flex-direction: column;
            gap: 8px; 
            min-width: 400px;
            max-width: 600px;
        }
        .match-btn {
            padding: 10px 12px;
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            text-align: left;
            width: 100%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .match-btn:hover { 
            background: #30363d; 
            border-color: #58a6ff;
            transform: translateX(2px);
        }
        .match-btn.active { 
            background: #238636; 
            border-color: #2ea043;
            box-shadow: 0 0 0 2px rgba(35, 134, 54, 0.3);
        }
        .match-btn.empty { opacity: 0.3; cursor: not-allowed; }
        .match-score {
            font-weight: 600;
            color: #58a6ff;
            min-width: 45px;
            flex-shrink: 0;
        }
        .match-btn.active .match-score {
            color: #7ee787;
        }
        .match-name {
            flex: 1;
            word-break: break-word;
            line-height: 1.4;
        }
        .actions-cell { 
            display: flex; 
            gap: 6px;
            width: 220px;
        }
        .manual-btn, .new-btn {
            padding: 6px 10px;
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }
        .manual-btn:hover { background: #30363d; border-color: #d29922; }
        .new-btn:hover { background: #30363d; border-color: #8250df; }
        .new-btn.active { background: #8250df; border-color: #a371f7; }
        .selection-cell { width: 250px; font-size: 12px; color: #7ee787; }
        .status-cell { width: 30px; font-size: 16px; text-align: center; }
        .action-bar {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .generate-btn {
            padding: 10px 20px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .generate-btn:hover { background: #2ea043; }
        .reset-btn:hover { background: #21262d; }
        .output-section {
            margin-top: 20px;
            padding: 15px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            display: none;
        }
        .output-section.visible { display: block; }
        .output-section h3 { color: #238636; margin-bottom: 10px; font-size: 18px; }
        .output-section p { margin: 8px 0; line-height: 1.6; }
        .search-hyvee-btn {
            background: #8250df;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 15px;
        }
        .search-hyvee-btn:hover { background: #6e40c9; }
        .json-output {
            width: 100%;
            height: 150px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 10px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            color: #7ee787;
            resize: vertical;
        }
        .copy-btn {
            margin-top: 8px;
            padding: 8px 16px;
            background: #da3633;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .copy-btn:hover { background: #f85149; }
        .new-items-section {
            margin-top: 15px;
            padding: 15px;
            background: #161b22;
            border-radius: 6px;
        }
        .new-items-section h4 { margin: 0 0 10px 0; color: #8250df; }
        .new-items-list { color: #7ee787; font-family: 'SF Mono', Monaco, monospace; font-size: 12px; }
        
        /* Modal for manual selection */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
        }
        .modal.visible { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: #161b22;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-header h2 { margin: 0; color: #58a6ff; font-size: 18px; }
        .modal-close {
            background: #da3633;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .modal-close:hover { background: #f85149; }
        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }
        .search-box:focus { border-color: #58a6ff; outline: none; }
        .product-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .product-item {
            padding: 10px;
            margin-bottom: 6px;
            background: #21262d;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .product-item:hover { background: #30363d; }
        .product-item.hidden { display: none; }
        .product-key { font-family: 'SF Mono', Monaco, monospace; color: #7ee787; }
        .product-display { color: #8b949e; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Fuzzy Match Existing Products</h1>
        <div class="phase-nav">
            <button class="phase-btn active" onclick="return false;">
                üß† Phase 1: Match Existing
            </button>
            <button class="phase-btn inactive" onclick="navigateToPhase2()" id="phase2-btn">
                üîç Phase 2: Hy-Vee Search
            </button>
            <button class="phase-btn inactive" onclick="navigateToPhase3()" id="phase3-btn">
                üõí Phase 3: Add to Cart
            </button>
        </div>
    </div>
    
    <div class="stats">
        <span class="stat">Remaining: <strong>3 / 3</strong></span>
        <span class="stat">Mapped: <strong id="matched-count">0</strong></span>
        <span class="stat">New: <strong id="new-count">0</strong></span>
    </div>
    
    <p style="color: #8b949e; font-size: 13px; margin-bottom: 15px;">
        Before searching Hy-Vee, let's check if these items already exist in your product library with slightly different names.
        Select a fuzzy match, browse the full list, or mark as NEW to search Hy-Vee.
    </p>
    
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Item from Google Tasks</th>
                <th>Qty</th>
                <th>Top 3 Fuzzy Matches (click to select)</th>
                <th>Actions</th>
                <th>Selection</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="items-body">
            
        <tr data-item="One votive candle" data-original="One votive candle" data-status="pending" data-quantity="1">
            <td class="row-num">1</td>
            <td class="item-name"><span class="editable-item" contenteditable="true" spellcheck="false" onblur="trackEdit(this)">One votive candle</span></td>
            <td class="qty-cell"><input type="number" class="qty-input" value="1" min="1" max="99" onchange="updateQuantity(this)" /></td>
            <td class="matches-cell">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="match-btn" onclick="selectMatch(this, 'avocado')" data-match="avocado" title="Hass Avocados"><span class="match-score">45%</span> <span class="match-name">Hass Avocados</span></button>
                    <button class="match-btn empty" disabled>‚Äî</button>
                    <button class="match-btn empty" disabled>‚Äî</button>
                </div>
            </td>
            <td class="actions-cell">
                <button class="manual-btn" onclick="showManualSelect(this)">üìã Browse All</button>
                <button class="new-btn active" onclick="markAsNew(this)">‚ú® NEW</button>
            </td>
            <td class="selection-cell"></td>
            <td class="status-cell">üÜï</td>
        </tr>
        <tr data-item="Cantaloupe" data-original="Cantaloupe" data-status="pending" data-quantity="1">
            <td class="row-num">2</td>
            <td class="item-name"><span class="editable-item" contenteditable="true" spellcheck="false" onblur="trackEdit(this)">Cantaloupe</span></td>
            <td class="qty-cell"><input type="number" class="qty-input" value="1" min="1" max="99" onchange="updateQuantity(this)" /></td>
            <td class="matches-cell">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="match-btn empty" disabled>‚Äî</button>
                    <button class="match-btn empty" disabled>‚Äî</button>
                    <button class="match-btn empty" disabled>‚Äî</button>
                </div>
            </td>
            <td class="actions-cell">
                <button class="manual-btn" onclick="showManualSelect(this)">üìã Browse All</button>
                <button class="new-btn active" onclick="markAsNew(this)">‚ú® NEW</button>
            </td>
            <td class="selection-cell"></td>
            <td class="status-cell">üÜï</td>
        </tr>
        <tr data-item="C9bb salll√†d kit" data-original="C9bb salll√†d kit" data-status="pending" data-quantity="1">
            <td class="row-num">3</td>
            <td class="item-name"><span class="editable-item" contenteditable="true" spellcheck="false" onblur="trackEdit(this)">C9bb salll√†d kit</span></td>
            <td class="qty-cell"><input type="number" class="qty-input" value="1" min="1" max="99" onchange="updateQuantity(this)" /></td>
            <td class="matches-cell">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="match-btn" onclick="selectMatch(this, 'asian salad kit')" data-match="asian salad kit" title="Dole Chopped Sesame Asian"><span class="match-score">58%</span> <span class="match-name">Dole Chopped Sesame Asian</span></button>
                    <button class="match-btn" onclick="selectMatch(this, '1 lb salted butter')" data-match="1 lb salted butter" title="Hy Vee Sweet Cream Salted Butter Quarters"><span class="match-score">50%</span> <span class="match-name">Hy Vee Sweet Cream Salted Butter Quarters</span></button>
                    <button class="match-btn empty" disabled>‚Äî</button>
                </div>
            </td>
            <td class="actions-cell">
                <button class="manual-btn" onclick="showManualSelect(this)">üìã Browse All</button>
                <button class="new-btn active" onclick="markAsNew(this)">‚ú® NEW</button>
            </td>
            <td class="selection-cell"></td>
            <td class="status-cell">üÜï</td>
        </tr>
        </tbody>
    </table>
    
    <div class="action-bar">
        <button class="generate-btn" onclick="updateListDetails()">‚ú® Update List Details</button>
        <button class="reset-btn" onclick="resetAllSelections()" style="background: #30363d; color: #c9d1d9; border: 1px solid #30363d; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-left: 10px;">‚Ü∫ Reset All</button>
        <span style="color: #8b949e; font-size: 12px; margin-left: 10px;">
            (Adds variations to products.json, renames tasks, refreshes page)
        </span>
    </div>
    
    <div class="output-section" id="output-section">
        <h3 id="output-title">‚è≥ Processing...</h3>
        <div id="output-content"></div>
    </div>
    
    <!-- Manual selection modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Browse All Products</h2>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <input type="text" class="search-box" id="modal-search" placeholder="Type to filter..." onkeyup="filterProducts()">
            <div class="product-list" id="product-list">
                <div class="product-item" onclick="selectProduct('1 lb salted butter')"><span class="product-display">Hy Vee Sweet Cream Salted Butter Quarters</span><span class="product-key">1 lb salted butter</span></div>
<div class="product-item" onclick="selectProduct('409 spray')"><span class="product-display">Formula 409 Multi Surface Original Cleaner Spray</span><span class="product-key">409 spray</span></div>
<div class="product-item" onclick="selectProduct('5 bananas')"><span class="product-display">Fresh Chiquita Bananas</span><span class="product-key">5 bananas</span></div>
<div class="product-item" onclick="selectProduct('8 oz package cream cheese')"><span class="product-display">Hy Vee Cream Cheese</span><span class="product-key">8 oz package cream cheese</span></div>
<div class="product-item" onclick="selectProduct('american cheese slices')"><span class="product-display">Hy Vee Singles American Cheese 24ct</span><span class="product-key">american cheese slices</span></div>
<div class="product-item" onclick="selectProduct('angel hair spaghetti')"><span class="product-display">Hy Vee Angel Hair</span><span class="product-key">angel hair spaghetti</span></div>
<div class="product-item" onclick="selectProduct('asian salad kit')"><span class="product-display">Dole Chopped Sesame Asian</span><span class="product-key">asian salad kit</span></div>
<div class="product-item" onclick="selectProduct('avocado')"><span class="product-display">Hass Avocados</span><span class="product-key">avocado</span></div>
<div class="product-item" onclick="selectProduct('bag of potatoes')"><span class="product-display">Green Giant Red Potatoes</span><span class="product-key">bag of potatoes</span></div>
<div class="product-item" onclick="selectProduct('baja blast zero')"><span class="product-display">Mountain Dew Zero Sugar Baja Blast 12 Pack</span><span class="product-key">baja blast zero</span></div>
<div class="product-item" onclick="selectProduct('baked beans (canned)')"><span class="product-display">Hy-Vee Maple Cured Bacon Baked Beans</span><span class="product-key">baked beans (canned)</span></div>
<div class="product-item" onclick="selectProduct('bananas')"><span class="product-display">Fresh Chiquita Bananas</span><span class="product-key">bananas</span></div>
<div class="product-item" onclick="selectProduct('bread whole wheat')"><span class="product-display">Daves Killer Bread 21 Whole Grains And Seeds Whole Grain Organic Bread</span><span class="product-key">bread whole wheat</span></div>
<div class="product-item" onclick="selectProduct('butter 2 lb ( salted and parentheses')"><span class="product-display">Hyvee Sweet Cream Salted Butter Quarters</span><span class="product-key">butter 2 lb ( salted and parentheses</span></div>
<div class="product-item" onclick="selectProduct('chicken thigs')"><span class="product-display">Hyvee True All Natural Cage Free Boneless Skinless Chicken Thigh Meat</span><span class="product-key">chicken thigs</span></div>
<div class="product-item" onclick="selectProduct('christmas cookies from delhi')"><span class="product-display">Bakery Fresh Spritz And Thumbprint Tray 48 Count</span><span class="product-key">christmas cookies from delhi</span></div>
<div class="product-item" onclick="selectProduct('chuck roast (2-3 lb)')"><span class="product-display">Hy-Vee Choice Reserve Beef Bottom Round Roast</span><span class="product-key">chuck roast (2-3 lb)</span></div>
<div class="product-item" onclick="selectProduct('cinnamon rolls ( not jumbo)')"><span class="product-display">Pillsbury Original Icing Cinnamon Rolls 8 count</span><span class="product-key">cinnamon rolls ( not jumbo)</span></div>
<div class="product-item" onclick="selectProduct('cinnamon rolls parentheses in tubes)')"><span class="product-display">Pillsbury Original Icing Cinnamon Rolls 8 Count</span><span class="product-key">cinnamon rolls parentheses in tubes)</span></div>
<div class="product-item" onclick="selectProduct('cocktail shrimp')"><span class="product-display">Fish Market Shrimp Platter With Cocktail Sauce 2630 Cooked And Peeled</span><span class="product-key">cocktail shrimp</span></div>
<div class="product-item" onclick="selectProduct('cottage cheese (3x)')"><span class="product-display">Hy-Vee 4% Small Curd Cottage Cheese</span><span class="product-key">cottage cheese (3x)</span></div>
<div class="product-item" onclick="selectProduct('cottage cheese two small containers')"><span class="product-display">Hyvee 4 Small Curd Cottage Cheese</span><span class="product-key">cottage cheese two small containers</span></div>
<div class="product-item" onclick="selectProduct('craft macaroni and cheese')"><span class="product-display">Kraft Thick N Creamy Mac And Cheese Macaroni And Cheese Dinner</span><span class="product-key">craft macaroni and cheese</span></div>
<div class="product-item" onclick="selectProduct('cran 5')"><span class="product-display">Ocean Spray Diet Cranberry Juice Drink</span><span class="product-key">cran 5</span></div>
<div class="product-item" onclick="selectProduct('cranberry juice free bottles')"><span class="product-display">Ocean Spray Diet Cranberry Juice Drink</span><span class="product-key">cranberry juice free bottles</span></div>
<div class="product-item" onclick="selectProduct('cream of mushroom soup')"><span class="product-display">Campbells 25 Less Sodium Cream Of Mushroom Condensed Soup</span><span class="product-key">cream of mushroom soup</span></div>
<div class="product-item" onclick="selectProduct('dave's bread whole wheat')"><span class="product-display">Dave's Killer Bread Good Seed Whole Grain Organic Bread</span><span class="product-key">dave's bread whole wheat</span></div>
<div class="product-item" onclick="selectProduct('dawn dish soap')"><span class="product-display">Dawn Platinum Powerwash Dish Spray Dish Soap Fresh Scent Refill</span><span class="product-key">dawn dish soap</span></div>
<div class="product-item" onclick="selectProduct('fresca bottles')"><span class="product-display">Fresca Grapefruit Citrus Soda 6pk</span><span class="product-key">fresca bottles</span></div>
<div class="product-item" onclick="selectProduct('fresh bass')"><span class="product-display">Fresh USA Farm Raised Rainbow Trout Fillets</span><span class="product-key">fresh bass</span></div>
<div class="product-item" onclick="selectProduct('fresh lemon')"><span class="product-display">Kings River Lemons Premium Citrus</span><span class="product-key">fresh lemon</span></div>
<div class="product-item" onclick="selectProduct('fresh mushrooms')"><span class="product-display">Highline Sliced White Mushrooms</span><span class="product-key">fresh mushrooms</span></div>
<div class="product-item" onclick="selectProduct('fresh thyme')"><span class="product-display">Ernessi Farms Thyme</span><span class="product-key">fresh thyme</span></div>
<div class="product-item" onclick="selectProduct('froxen spagheet and meat sauce dinner')"><span class="product-display">Stouffers Spaghetti With Meat Sauce Frozen Meal</span><span class="product-key">froxen spagheet and meat sauce dinner</span></div>
<div class="product-item" onclick="selectProduct('frozen lima beans')"><span class="product-display">Hy-Vee Baby Lima Beans Fresh Steam</span><span class="product-key">frozen lima beans</span></div>
<div class="product-item" onclick="selectProduct('frozen mixed vegetables')"><span class="product-display">Birds Eye Steamfresh Mixed Vegetables Frozen Vegetables 10 Oz Bag</span><span class="product-key">frozen mixed vegetables</span></div>
<div class="product-item" onclick="selectProduct('frozen pizza')"><span class="product-display">Brew Pub Lotzza Motzza Pepperoni Pizza</span><span class="product-key">frozen pizza</span></div>
<div class="product-item" onclick="selectProduct('frozen shrimp alfredo')"><span class="product-display">Lean Cuisine Protein Kick Shrimp Alfredo</span><span class="product-key">frozen shrimp alfredo</span></div>
<div class="product-item" onclick="selectProduct('frozen shrimp cocktail')"><span class="product-display">Fish Market Shrimp Platter with Cocktail Sauce</span><span class="product-key">frozen shrimp cocktail</span></div>
<div class="product-item" onclick="selectProduct('frozen sweedish meatballs')"><span class="product-display">Boston Market Swedish Meatballs Swedish Meatballs 131 Oz</span><span class="product-key">frozen sweedish meatballs</span></div>
<div class="product-item" onclick="selectProduct('fruit pop tarts')"><span class="product-display">Hy-Vee Frosted Toaster Pastries Variety Pack 12Ct</span><span class="product-key">fruit pop tarts</span></div>
<div class="product-item" onclick="selectProduct('gallon sized ziplocs')"><span class="product-display">Ziploc Gallon Storage Slider Bags 12 Ea</span><span class="product-key">gallon sized ziplocs</span></div>
<div class="product-item" onclick="selectProduct('garlic')"><span class="product-display">Jumbo Garlic</span><span class="product-key">garlic</span></div>
<div class="product-item" onclick="selectProduct('glasstop cleaner')"><span class="product-display">Bar Keepers Friend Cooktop Cleaner</span><span class="product-key">glasstop cleaner</span></div>
<div class="product-item" onclick="selectProduct('grape juice')"><span class="product-display">Old Orchard Healthy Balance Diet Grape Juice Cocktail</span><span class="product-key">grape juice</span></div>
<div class="product-item" onclick="selectProduct('half and half')"><span class="product-display">Search</span><span class="product-key">half and half</span></div>
<div class="product-item" onclick="selectProduct('havarti cheese slices')"><span class="product-display">Hy Vee Sliced Havarti Cheese</span><span class="product-key">havarti cheese slices</span></div>
<div class="product-item" onclick="selectProduct('healthy orchard grape 2x')"><span class="product-display">Old Orchard Healthy Balance Diet Grape Juice Cocktail</span><span class="product-key">healthy orchard grape 2x</span></div>
<div class="product-item" onclick="selectProduct('honeydew')"><span class="product-display">Honeydew Ready To Eat</span><span class="product-key">honeydew</span></div>
<div class="product-item" onclick="selectProduct('hungry man meatloaf frozen meal')"><span class="product-display">Boston Market Meatloaf</span><span class="product-key">hungry man meatloaf frozen meal</span></div>
<div class="product-item" onclick="selectProduct('iceberg lettuce')"><span class="product-display">Dole Iceberg Lettuce</span><span class="product-key">iceberg lettuce</span></div>
<div class="product-item" onclick="selectProduct('large chunk chocolate chip coookies')"><span class="product-display">Chips Ahoy Chunky Chocolate Chip Cookies Family Size</span><span class="product-key">large chunk chocolate chip coookies</span></div>
<div class="product-item" onclick="selectProduct('lemonaide')"><span class="product-display">Minute Maid Sugar Lemonade Juice</span><span class="product-key">lemonaide</span></div>
<div class="product-item" onclick="selectProduct('lightly salted chips')"><span class="product-display">Lay's Lightly Salted Classic Potato Chips</span><span class="product-key">lightly salted chips</span></div>
<div class="product-item" onclick="selectProduct('lightly salted potato chips')"><span class="product-display">Lays Lightly Salted Classic Potato Chips</span><span class="product-key">lightly salted potato chips</span></div>
<div class="product-item" onclick="selectProduct('miralax laxative large bottle')"><span class="product-display">Miralax 30 Once Daily Doses Powder Laxative</span><span class="product-key">miralax laxative large bottle</span></div>
<div class="product-item" onclick="selectProduct('one box frozen shrimp alfredo dinner')"><span class="product-display">Lean Cuisine Protein Kick Shrimp Alfredo</span><span class="product-key">one box frozen shrimp alfredo dinner</span></div>
<div class="product-item" onclick="selectProduct('one container sugar-free cool whip')"><span class="product-display">Hy-Vee Whipped Topping Zero Sugar</span><span class="product-key">one container sugar-free cool whip</span></div>
<div class="product-item" onclick="selectProduct('one kimbasa')"><span class="product-display">Hillshire Farm Polska Kielbasa Smoked Sausage 14 Oz</span><span class="product-key">one kimbasa</span></div>
<div class="product-item" onclick="selectProduct('orange')"><span class="product-display">Navel Oranges Large</span><span class="product-key">orange</span></div>
<div class="product-item" onclick="selectProduct('pack of dish sponges')"><span class="product-display">Scotch-Brite Heavy Duty Scrub Sponges</span><span class="product-key">pack of dish sponges</span></div>
<div class="product-item" onclick="selectProduct('pickled herring')"><span class="product-display">Fish Market Herring Fillets In Wine Sauce</span><span class="product-key">pickled herring</span></div>
<div class="product-item" onclick="selectProduct('potato chips: salt and vinegar flavor')"><span class="product-display">Cape Cod Sea Salt And Vinegar Potato Chips</span><span class="product-key">potato chips: salt and vinegar flavor</span></div>
<div class="product-item" onclick="selectProduct('ready-made mashed potatoes (bob evans)')"><span class="product-display">Bob Evans Original Mashed Potatoes</span><span class="product-key">ready-made mashed potatoes (bob evans)</span></div>
<div class="product-item" onclick="selectProduct('refresh artificial tears')"><span class="product-display">Refresh Tears Pf Lubricant Eye Drops</span><span class="product-key">refresh artificial tears</span></div>
<div class="product-item" onclick="selectProduct('saltines')"><span class="product-display">Premium Saltine Crackers Original</span><span class="product-key">saltines</span></div>
<div class="product-item" onclick="selectProduct('short carrots')"><span class="product-display">Grimmway Baby Carrots</span><span class="product-key">short carrots</span></div>
<div class="product-item" onclick="selectProduct('shredded cheddar cheese')"><span class="product-display">Hyvee Finely Shredded Mild Cheddar Natural Cheese</span><span class="product-key">shredded cheddar cheese</span></div>
<div class="product-item" onclick="selectProduct('shredded cheddar cheese sharp')"><span class="product-display">Hy Vee Shredded Sharp Cheddar Cheese</span><span class="product-key">shredded cheddar cheese sharp</span></div>
<div class="product-item" onclick="selectProduct('shredded lettuce')"><span class="product-display">Dole Shredded Iceberg Lettuce</span><span class="product-key">shredded lettuce</span></div>
<div class="product-item" onclick="selectProduct('silver polish colon 1 wright''s')"><span class="product-display">Twinkle Silver Polish Kit 4375 Oz</span><span class="product-key">silver polish colon 1 wright''s</span></div>
<div class="product-item" onclick="selectProduct('small bag of yellow onions (maple and bacon variety)')"><span class="product-display">Yellow Onions</span><span class="product-key">small bag of yellow onions (maple and bacon variety)</span></div>
<div class="product-item" onclick="selectProduct('sociables crackers two boxes')"><span class="product-display">Sociables Flavor Originals Sociables Baked Savory Crackers Party Snacks</span><span class="product-key">sociables crackers two boxes</span></div>
<div class="product-item" onclick="selectProduct('sour cream two small containers')"><span class="product-display">Hyvee Light Sour Cream</span><span class="product-key">sour cream two small containers</span></div>
<div class="product-item" onclick="selectProduct('spaghetti sauce')"><span class="product-display">Gustare Vita Tomato Basil Pasta Sauce</span><span class="product-key">spaghetti sauce</span></div>
<div class="product-item" onclick="selectProduct('spinach, fresh')"><span class="product-display">Josies Organics Organic Baby Spinach</span><span class="product-key">spinach, fresh</span></div>
<div class="product-item" onclick="selectProduct('splenda packages large box')"><span class="product-display">Splenda No Calorie Sweetener Individual Packets</span><span class="product-key">splenda packages large box</span></div>
<div class="product-item" onclick="selectProduct('stuffing mix')"><span class="product-display">Pepperidge Farm Herb Seasoned Classic Stuffing</span><span class="product-key">stuffing mix</span></div>
<div class="product-item" onclick="selectProduct('swedish meatball frozen meal')"><span class="product-display">Marie Callenders Swedish Meatballs Bowl Frozen Meal</span><span class="product-key">swedish meatball frozen meal</span></div>
<div class="product-item" onclick="selectProduct('taco kit')"><span class="product-display">Old El Paso Stand n Stuff Taco Dinner Kit</span><span class="product-key">taco kit</span></div>
<div class="product-item" onclick="selectProduct('tapioca pudding cups')"><span class="product-display">Swiss Miss Tapioca Pudding 4 Oz 6count</span><span class="product-key">tapioca pudding cups</span></div>
<div class="product-item" onclick="selectProduct('tartar sauce')"><span class="product-display">Hy-Vee Tartar Sauce</span><span class="product-key">tartar sauce</span></div>
<div class="product-item" onclick="selectProduct('that's my mom's salad dressing')"><span class="product-display">Hy Vee Thousand Island Dressing</span><span class="product-key">that's my mom's salad dressing</span></div>
<div class="product-item" onclick="selectProduct('tomatoes')"><span class="product-display">Tomatoes on the Vine</span><span class="product-key">tomatoes</span></div>
<div class="product-item" onclick="selectProduct('tomatoes 3')"><span class="product-display">Roma Tomatoes</span><span class="product-key">tomatoes 3</span></div>
<div class="product-item" onclick="selectProduct('tropicana lite 50')"><span class="product-display">Tropicana Light No Pulp Orange Juice</span><span class="product-key">tropicana lite 50</span></div>
<div class="product-item" onclick="selectProduct('turkey lunch meat')"><span class="product-display">Land O'Frost Premium Honey Smoked Turkey Breast</span><span class="product-key">turkey lunch meat</span></div>
<div class="product-item" onclick="selectProduct('two boxes vanilla wafers')"><span class="product-display">Nabisco Nilla Wafers</span><span class="product-key">two boxes vanilla wafers</span></div>
<div class="product-item" onclick="selectProduct('two dozen eggs')"><span class="product-display">Hy Vee Grade A Large Eggs</span><span class="product-key">two dozen eggs</span></div>
<div class="product-item" onclick="selectProduct('very lean ground beef')"><span class="product-display">93% Lean 7% Fat Fresh Ground Beef</span><span class="product-key">very lean ground beef</span></div>
<div class="product-item" onclick="selectProduct('watermelon')"><span class="product-display">Watermelon Wedges With Skin</span><span class="product-key">watermelon</span></div>
<div class="product-item" onclick="selectProduct('white vinegar')"><span class="product-display">Hyvee White Distilled Vinegar</span><span class="product-key">white vinegar</span></div>
<div class="product-item" onclick="selectProduct('whole frozen quiche')"><span class="product-display">La Terra Fina Spinach And Artichoke Quiche</span><span class="product-key">whole frozen quiche</span></div>
<div class="product-item" onclick="selectProduct('whole weat egg noodles')"><span class="product-display">Hyvee Select Whole Wheat Homemade Noodles</span><span class="product-key">whole weat egg noodles</span></div>
<div class="product-item" onclick="selectProduct('whole wheat egg noodles')"><span class="product-display">Hy-Vee Select Whole Wheat Homemade Noodles</span><span class="product-key">whole wheat egg noodles</span></div>
<div class="product-item" onclick="selectProduct('yasso bars 2x cherry chocolate crunch')"><span class="product-display">Yasso Frozen Greek Yogurt Cherry Chocolate Crunch Bars 4ct</span><span class="product-key">yasso bars 2x cherry chocolate crunch</span></div>
<div class="product-item" onclick="selectProduct('yasso bars 2x chocolate fudge')"><span class="product-display">Yasso Chocolate Fudge Frozen Greek Yogurt Bars 4 35 Fl Oz</span><span class="product-key">yasso bars 2x chocolate fudge</span></div>
<div class="product-item" onclick="selectProduct('yasso bars 2x cookie dough')"><span class="product-display">Yasso Chocolate Chip Cookie Dough Frozen Greek Yogurt Bars 435 Fl Oz</span><span class="product-key">yasso bars 2x cookie dough</span></div>
            </div>
        </div>
    </div>
    
    <script>
        let currentRow = null;
        const allProducts = [
    { "key": "1 lb salted butter", "display": "Hy Vee Sweet Cream Salted Butter Quarters" },
    { "key": "409 spray", "display": "Formula 409 Multi Surface Original Cleaner Spray" },
    { "key": "5 bananas", "display": "Fresh Chiquita Bananas" },
    { "key": "8 oz package cream cheese", "display": "Hy Vee Cream Cheese" },
    { "key": "american cheese slices", "display": "Hy Vee Singles American Cheese 24ct" },
    { "key": "angel hair spaghetti", "display": "Hy Vee Angel Hair" },
    { "key": "asian salad kit", "display": "Dole Chopped Sesame Asian" },
    { "key": "avocado", "display": "Hass Avocados" },
    { "key": "bag of potatoes", "display": "Green Giant Red Potatoes" },
    { "key": "baja blast zero", "display": "Mountain Dew Zero Sugar Baja Blast 12 Pack" },
    { "key": "baked beans (canned)", "display": "Hy-Vee Maple Cured Bacon Baked Beans" },
    { "key": "bananas", "display": "Fresh Chiquita Bananas" },
    { "key": "bread whole wheat", "display": "Daves Killer Bread 21 Whole Grains And Seeds Whole Grain Organic Bread" },
    { "key": "butter 2 lb ( salted and parentheses", "display": "Hyvee Sweet Cream Salted Butter Quarters" },
    { "key": "chicken thigs", "display": "Hyvee True All Natural Cage Free Boneless Skinless Chicken Thigh Meat" },
    { "key": "christmas cookies from delhi", "display": "Bakery Fresh Spritz And Thumbprint Tray 48 Count" },
    { "key": "chuck roast (2-3 lb)", "display": "Hy-Vee Choice Reserve Beef Bottom Round Roast" },
    { "key": "cinnamon rolls ( not jumbo)", "display": "Pillsbury Original Icing Cinnamon Rolls 8 count" },
    { "key": "cinnamon rolls parentheses in tubes)", "display": "Pillsbury Original Icing Cinnamon Rolls 8 Count" },
    { "key": "cocktail shrimp", "display": "Fish Market Shrimp Platter With Cocktail Sauce 2630 Cooked And Peeled" },
    { "key": "cottage cheese (3x)", "display": "Hy-Vee 4% Small Curd Cottage Cheese" },
    { "key": "cottage cheese two small containers", "display": "Hyvee 4 Small Curd Cottage Cheese" },
    { "key": "craft macaroni and cheese", "display": "Kraft Thick N Creamy Mac And Cheese Macaroni And Cheese Dinner" },
    { "key": "cran 5", "display": "Ocean Spray Diet Cranberry Juice Drink" },
    { "key": "cranberry juice free bottles", "display": "Ocean Spray Diet Cranberry Juice Drink" },
    { "key": "cream of mushroom soup", "display": "Campbells 25 Less Sodium Cream Of Mushroom Condensed Soup" },
    { "key": "dave's bread whole wheat", "display": "Dave's Killer Bread Good Seed Whole Grain Organic Bread" },
    { "key": "dawn dish soap", "display": "Dawn Platinum Powerwash Dish Spray Dish Soap Fresh Scent Refill" },
    { "key": "fresca bottles", "display": "Fresca Grapefruit Citrus Soda 6pk" },
    { "key": "fresh bass", "display": "Fresh USA Farm Raised Rainbow Trout Fillets" },
    { "key": "fresh lemon", "display": "Kings River Lemons Premium Citrus" },
    { "key": "fresh mushrooms", "display": "Highline Sliced White Mushrooms" },
    { "key": "fresh thyme", "display": "Ernessi Farms Thyme" },
    { "key": "froxen spagheet and meat sauce dinner", "display": "Stouffers Spaghetti With Meat Sauce Frozen Meal" },
    { "key": "frozen lima beans", "display": "Hy-Vee Baby Lima Beans Fresh Steam" },
    { "key": "frozen mixed vegetables", "display": "Birds Eye Steamfresh Mixed Vegetables Frozen Vegetables 10 Oz Bag" },
    { "key": "frozen pizza", "display": "Brew Pub Lotzza Motzza Pepperoni Pizza" },
    { "key": "frozen shrimp alfredo", "display": "Lean Cuisine Protein Kick Shrimp Alfredo" },
    { "key": "frozen shrimp cocktail", "display": "Fish Market Shrimp Platter with Cocktail Sauce" },
    { "key": "frozen sweedish meatballs", "display": "Boston Market Swedish Meatballs Swedish Meatballs 131 Oz" },
    { "key": "fruit pop tarts", "display": "Hy-Vee Frosted Toaster Pastries Variety Pack 12Ct" },
    { "key": "gallon sized ziplocs", "display": "Ziploc Gallon Storage Slider Bags 12 Ea" },
    { "key": "garlic", "display": "Jumbo Garlic" },
    { "key": "glasstop cleaner", "display": "Bar Keepers Friend Cooktop Cleaner" },
    { "key": "grape juice", "display": "Old Orchard Healthy Balance Diet Grape Juice Cocktail" },
    { "key": "half and half", "display": "Search" },
    { "key": "havarti cheese slices", "display": "Hy Vee Sliced Havarti Cheese" },
    { "key": "healthy orchard grape 2x", "display": "Old Orchard Healthy Balance Diet Grape Juice Cocktail" },
    { "key": "honeydew", "display": "Honeydew Ready To Eat" },
    { "key": "hungry man meatloaf frozen meal", "display": "Boston Market Meatloaf" },
    { "key": "iceberg lettuce", "display": "Dole Iceberg Lettuce" },
    { "key": "large chunk chocolate chip coookies", "display": "Chips Ahoy Chunky Chocolate Chip Cookies Family Size" },
    { "key": "lemonaide", "display": "Minute Maid Sugar Lemonade Juice" },
    { "key": "lightly salted chips", "display": "Lay's Lightly Salted Classic Potato Chips" },
    { "key": "lightly salted potato chips", "display": "Lays Lightly Salted Classic Potato Chips" },
    { "key": "miralax laxative large bottle", "display": "Miralax 30 Once Daily Doses Powder Laxative" },
    { "key": "one box frozen shrimp alfredo dinner", "display": "Lean Cuisine Protein Kick Shrimp Alfredo" },
    { "key": "one container sugar-free cool whip", "display": "Hy-Vee Whipped Topping Zero Sugar" },
    { "key": "one kimbasa", "display": "Hillshire Farm Polska Kielbasa Smoked Sausage 14 Oz" },
    { "key": "orange", "display": "Navel Oranges Large" },
    { "key": "pack of dish sponges", "display": "Scotch-Brite Heavy Duty Scrub Sponges" },
    { "key": "pickled herring", "display": "Fish Market Herring Fillets In Wine Sauce" },
    { "key": "potato chips: salt and vinegar flavor", "display": "Cape Cod Sea Salt And Vinegar Potato Chips" },
    { "key": "ready-made mashed potatoes (bob evans)", "display": "Bob Evans Original Mashed Potatoes" },
    { "key": "refresh artificial tears", "display": "Refresh Tears Pf Lubricant Eye Drops" },
    { "key": "saltines", "display": "Premium Saltine Crackers Original" },
    { "key": "short carrots", "display": "Grimmway Baby Carrots" },
    { "key": "shredded cheddar cheese", "display": "Hyvee Finely Shredded Mild Cheddar Natural Cheese" },
    { "key": "shredded cheddar cheese sharp", "display": "Hy Vee Shredded Sharp Cheddar Cheese" },
    { "key": "shredded lettuce", "display": "Dole Shredded Iceberg Lettuce" },
    { "key": "silver polish colon 1 wright''s", "display": "Twinkle Silver Polish Kit 4375 Oz" },
    { "key": "small bag of yellow onions (maple and bacon variety)", "display": "Yellow Onions" },
    { "key": "sociables crackers two boxes", "display": "Sociables Flavor Originals Sociables Baked Savory Crackers Party Snacks" },
    { "key": "sour cream two small containers", "display": "Hyvee Light Sour Cream" },
    { "key": "spaghetti sauce", "display": "Gustare Vita Tomato Basil Pasta Sauce" },
    { "key": "spinach, fresh", "display": "Josies Organics Organic Baby Spinach" },
    { "key": "splenda packages large box", "display": "Splenda No Calorie Sweetener Individual Packets" },
    { "key": "stuffing mix", "display": "Pepperidge Farm Herb Seasoned Classic Stuffing" },
    { "key": "swedish meatball frozen meal", "display": "Marie Callenders Swedish Meatballs Bowl Frozen Meal" },
    { "key": "taco kit", "display": "Old El Paso Stand n Stuff Taco Dinner Kit" },
    { "key": "tapioca pudding cups", "display": "Swiss Miss Tapioca Pudding 4 Oz 6count" },
    { "key": "tartar sauce", "display": "Hy-Vee Tartar Sauce" },
    { "key": "that's my mom's salad dressing", "display": "Hy Vee Thousand Island Dressing" },
    { "key": "tomatoes", "display": "Tomatoes on the Vine" },
    { "key": "tomatoes 3", "display": "Roma Tomatoes" },
    { "key": "tropicana lite 50", "display": "Tropicana Light No Pulp Orange Juice" },
    { "key": "turkey lunch meat", "display": "Land O'Frost Premium Honey Smoked Turkey Breast" },
    { "key": "two boxes vanilla wafers", "display": "Nabisco Nilla Wafers" },
    { "key": "two dozen eggs", "display": "Hy Vee Grade A Large Eggs" },
    { "key": "very lean ground beef", "display": "93% Lean 7% Fat Fresh Ground Beef" },
    { "key": "watermelon", "display": "Watermelon Wedges With Skin" },
    { "key": "white vinegar", "display": "Hyvee White Distilled Vinegar" },
    { "key": "whole frozen quiche", "display": "La Terra Fina Spinach And Artichoke Quiche" },
    { "key": "whole weat egg noodles", "display": "Hyvee Select Whole Wheat Homemade Noodles" },
    { "key": "whole wheat egg noodles", "display": "Hy-Vee Select Whole Wheat Homemade Noodles" },
    { "key": "yasso bars 2x cherry chocolate crunch", "display": "Yasso Frozen Greek Yogurt Cherry Chocolate Crunch Bars 4ct" },
    { "key": "yasso bars 2x chocolate fudge", "display": "Yasso Chocolate Fudge Frozen Greek Yogurt Bars 4 35 Fl Oz" },
    { "key": "yasso bars 2x cookie dough", "display": "Yasso Chocolate Chip Cookie Dough Frozen Greek Yogurt Bars 435 Fl Oz" },
  ];
        const repoRoot = '/Users/pacey/Documents/SourceCode/grocery-automation';
        const listName = 'Groceries';
        
        function trackEdit(element) {
            const row = element.closest('tr');
            const newText = element.textContent.trim();
            const original = row.dataset.original;
            
            if (newText !== original && newText.length > 0) {
                row.dataset.item = newText;
                row.dataset.edited = 'true';
                element.classList.add('edited');
            } else {
                row.dataset.item = original;
                row.dataset.edited = 'false';
                element.classList.remove('edited');
            }
        }
        
        function updateQuantity(input) {
            const row = input.closest('tr');
            row.dataset.quantity = input.value;
        }
        
        function selectMatch(btn, matchKey) {
            const row = btn.closest('tr');
            
            // Clear other match buttons in this row
            row.querySelectorAll('.match-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Clear NEW button
            row.querySelector('.new-btn').classList.remove('active');
            
            // Update row state
            row.dataset.status = 'mapped';
            row.dataset.matchedTo = matchKey;
            row.classList.add('mapped');
            row.classList.remove('new');
            
            // Update selection display
            const product = allProducts.find(p => p.key === matchKey);
            const display = product ? product.display : matchKey;
            row.querySelector('.selection-cell').textContent = `‚Üí ${display}`;
            row.querySelector('.status-cell').textContent = '‚úÖ';
            
            updateCounts();
        }
        
        function markAsNew(btn) {
            const row = btn.closest('tr');
            
            // Clear all match buttons
            row.querySelectorAll('.match-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update row state
            row.dataset.status = 'new';
            row.dataset.matchedTo = '';
            row.classList.remove('mapped');
            row.classList.add('new');
            
            row.querySelector('.selection-cell').textContent = '';
            row.querySelector('.status-cell').textContent = 'üÜï';
            
            updateCounts();
        }
        
        function fadeOutRow(row) {
            row.classList.add('processed');
            setTimeout(() => {
                row.classList.add('hidden');
            }, 300);
        }
        
        function showManualSelect(btn) {
            currentRow = btn.closest('tr');
            document.getElementById('modal').classList.add('visible');
            document.getElementById('modal-search').value = '';
            document.getElementById('modal-search').focus();
            filterProducts();
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('visible');
            currentRow = null;
        }
        
        function filterProducts() {
            const query = document.getElementById('modal-search').value.toLowerCase();
            const items = document.querySelectorAll('.product-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.classList.toggle('hidden', !text.includes(query));
            });
        }
        
        function selectProduct(key) {
            if (!currentRow) return;
            
            // Clear other selections
            currentRow.querySelectorAll('.match-btn, .new-btn').forEach(b => b.classList.remove('active'));
            
            // Update row state
            currentRow.dataset.status = 'mapped';
            currentRow.dataset.matchedTo = key;
            currentRow.classList.add('mapped');
            currentRow.classList.remove('new');
            
            // Update display
            const product = allProducts.find(p => p.key === key);
            const display = product ? product.display : key;
            currentRow.querySelector('.selection-cell').textContent = `‚Üí ${display}`;
            currentRow.querySelector('.status-cell').textContent = '‚úÖ';
            
            updateCounts();
            closeModal();
        }
        
        function updateCounts() {
            const all = document.querySelectorAll('#items-body tr').length;
            const processed = document.querySelectorAll('tr.processed').length;
            const remaining = all - processed;
            const mapped = document.querySelectorAll('tr[data-status="mapped"]').length;
            const newItems = document.querySelectorAll('tr[data-status="new"]').length;
            
            document.getElementById('matched-count').textContent = mapped;
            document.getElementById('new-count').textContent = newItems;
            
            // Update header stat to show remaining
            const remainingStat = document.querySelector('.stats .stat strong');
            if (remainingStat) {
                remainingStat.textContent = `${remaining} / ${all}`;
            }
        }
        
        async function updateListDetails() {
            const btn = document.querySelector('.generate-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Processing...';
            
            const rows = document.querySelectorAll('#items-body tr');
            const substitutions = [];
            const taskRenames = [];
            const newItems = [];
            
            rows.forEach(row => {
                const originalName = row.dataset.original;
                const currentName = row.dataset.item;
                const quantity = parseInt(row.dataset.quantity) || 1;
                const status = row.dataset.status;
                const matchedTo = row.dataset.matchedTo;
                const wasEdited = row.dataset.edited === 'true';
                
                // Track task renames (edited items)
                if (wasEdited && currentName !== originalName) {
                    taskRenames.push({
                        from: originalName,
                        to: currentName
                    });
                }
                
                // Track substitutions (mapped items using current name)
                if (status === 'mapped' && matchedTo) {
                    substitutions.push({
                        key: currentName,
                        value: matchedTo,
                        quantity: quantity
                    });
                } else if (status === 'new') {
                    newItems.push({
                        name: currentName,
                        quantity: quantity
                    });
                }
            });
            
            // POST to backend server
            try {
                const response = await fetch('http://127.0.0.1:8766/apply-mappings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        repo_root: repoRoot,
                        list_name: listName,
                        substitutions: substitutions,
                        task_renames: taskRenames,
                        new_items: newItems
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }
                
                const result = await response.json();
                
                // Show success with detailed info
                document.getElementById('output-section').classList.add('visible');
                document.getElementById('output-title').textContent = '‚úÖ Changes Applied Successfully!';
                
                const variationsAdded = result.variations_added || substitutions.length;
                const tasksRenamed = result.tasks_renamed || 0;
                const newItemsCount = newItems.length;
                
                const newItemsDisplay = newItems.map(ni => `‚Ä¢ ${ni.name} (qty: ${ni.quantity})`).join('<br>');
                
                let successHtml = `
                    <div style="color: #7ee787; margin-bottom: 15px;">
                        <p style="font-size: 15px; font-weight: 600; margin-bottom: 10px;">Summary:</p>
                        <p>‚úì Added <strong>${variationsAdded}</strong> variation(s) to products.json original_requests</p>
                        <p>‚úì Renamed <strong>${tasksRenamed}</strong> task(s) in Google Tasks</p>
                        <p>‚úì Saved <strong>${newItemsCount}</strong> NEW item(s) for Hy-Vee search</p>
                    </div>
                `;
                
                if (newItemsCount > 0) {
                    successHtml += `
                        <div style="margin-top: 20px; padding: 15px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px;">
                            <h4 style="color: #8250df; margin: 0 0 12px 0; font-size: 16px;">‚ú® Items to search on Hy-Vee:</h4>
                            <div style="color: #7ee787; font-size: 14px; margin-bottom: 15px;">
                                ${newItemsDisplay}
                            </div>
                            <button class="search-hyvee-btn" onclick="proceedToHyveeSearch()">
                                üîç Search Hy-Vee for NEW Items
                            </button>
                        </div>
                    `;
                }
                
                successHtml += `
                    <p style="color: #8b949e; font-size: 13px; margin-top: 20px;">
                        Page will refresh automatically in 7 seconds to show updated list...
                        <button onclick="window.location.reload();" style="background: transparent; border: 1px solid #30363d; color: #58a6ff; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 10px; font-size: 12px;">Refresh Now</button>
                    </p>
                `;
                
                document.getElementById('output-content').innerHTML = successHtml;
                
                // Fade out all adjudicated rows
                rows.forEach(row => {
                    const status = row.dataset.status;
                    if (status === 'mapped' || status === 'new') {
                        fadeOutRow(row);
                    }
                });
                
                // Auto-refresh page to show updated list (HTML was regenerated on server)
                // Increased timeout so user can read the success message
                setTimeout(() => {
                    window.location.reload();
                }, 7000);
                
            } catch (error) {
                document.getElementById('output-section').classList.add('visible');
                document.getElementById('output-title').textContent = '‚ùå Error';
                document.getElementById('output-content').innerHTML = `
                    <p style="color: #f85149;">
                        Failed to apply changes: ${error.message}
                    </p>
                    <p style="color: #8b949e; font-size: 12px; margin-top: 10px;">
                        Make sure the Flask server is running (port 8766)
                    </p>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = '‚ú® Update List Details';
            }
        }
        
        // Navigate to Phase 2 (Hy-Vee search)
        async function navigateToPhase2() {
            const btn = document.getElementById('phase2-btn');
            if (btn.classList.contains('loading')) return;
            
            btn.classList.add('loading');
            btn.textContent = '‚è≥ Loading...';
            
            try {
                const response = await fetch('http://127.0.0.1:8766/proceed-to-hyvee-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        repo_root: repoRoot,
                        list_name: listName
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.hyvee_html) {
                    // Redirect to Hy-Vee search page
                    window.location.href = `http://127.0.0.1:8766/data/unmapped_items.html`;
                } else {
                    btn.classList.remove('loading');
                    btn.textContent = 'üîç Phase 2: Hy-Vee Search';
                    alert(result.message || 'No unmapped items found. All items are mapped!');
                }
            } catch (error) {
                btn.classList.remove('loading');
                btn.textContent = 'üîç Phase 2: Hy-Vee Search';
                alert('Failed to proceed to Hy-Vee search: ' + error.message);
            }
        }
        
        // Proceed to Hy-Vee search phase (kept for backward compatibility)
        async function proceedToHyveeSearch() {
            return navigateToPhase2();
        }
        
        // Navigate to Phase 3 (Add to Cart)
        async function navigateToPhase3() {
            const btn = document.getElementById('phase3-btn');
            btn.classList.add('loading');
            btn.textContent = '‚è≥ Loading...';
            
            // Redirect to the new dashboard
            const params = new URLSearchParams({
                list_name: listName,
                repo_root: repoRoot
            });
            window.location.href = 'http://127.0.0.1:8766/phase3?' + params.toString();
        }
        
        // Reset all selections
        function resetAllSelections() {
            if (!confirm('Reset all selections? This will clear all mappings and mark all items as pending.')) {
                return;
            }
            
            const rows = document.querySelectorAll('#items-body tr');
            rows.forEach(row => {
                row.dataset.status = 'pending';
                row.dataset.matchedTo = '';
                
                // Remove selection badge
                const badge = row.querySelector('.selection-badge');
                if (badge) badge.remove();
                
                // Reset row styling
                row.style.opacity = '1';
                row.style.backgroundColor = '';
                
                // Clear any selection indicators
                const selectionCell = row.querySelector('.selection-cell');
                if (selectionCell) {
                    selectionCell.innerHTML = '';
                }
            });
            
            updateCounts();
            
            // Hide output section if visible
            document.getElementById('output-section').classList.remove('visible');
        }
        
        // Close modal on escape key
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });
        
        // Initial count
        updateCounts();
    </script>
</body>
</html>